/**
 * Configuration management
 */
// プロパティサービスから値を取得
const SCRIPT_PROPERTIES = PropertiesService.getScriptProperties();

// -----------------------------------------------------------------------------
// 検索・API設定
// -----------------------------------------------------------------------------

// 検索するメールの最大件数
const SEARCH_MAX_COUNT = 100;
// 検索結果の取得開始位置（0始まり）
const SEARCH_START_INDEX = 0;

// 検索対象の日付（何日前か）
// プロパティ 'SEARCH_TARGET_DAYS_AGO' が設定されていればそれを使用
// 設定方法: Apps Scriptエディタ > プロジェクトの設定 > スクリプト プロパティ
const SEARCH_TARGET_DAYS_AGO = parseInt(SCRIPT_PROPERTIES.getProperty('SEARCH_TARGET_DAYS_AGO'), 10);
// 削除対象の日付（何日前か）
// プロパティ 'DELETE_TARGET_DAYS_AGO' が設定されていればそれを使用
const DELETE_TARGET_DAYS_AGO = parseInt(SCRIPT_PROPERTIES.getProperty('DELETE_TARGET_DAYS_AGO'), 10);

// Gemini API Endpoint
const GEMINI_API_ENDPOINT = SCRIPT_PROPERTIES.getProperty('GEMINI_API_ENDPOINT');
// Gemini API Rate Limit対策の待機時間(ms)
const GEMINI_API_WAIT_MS = 5000;
// Gemini API パラメータ
const GEMINI_PARAM_TEMPERATURE = 0.0;
const GEMINI_PARAM_MAX_TOKENS = 500;

const ZAIM_API_BASE_URL = 'https://api.zaim.net/v2';
// Zaim API Rate Limit対策の待機時間(ms)
const ZAIM_API_WAIT_MS = 1000;
const ZAIM_DELETE_WAIT_MS = 500;
// Zaimデータ取得時の件数上限
const ZAIM_SEARCH_LIMIT = 100;
// Zaim登録時のデフォルトカテゴリ・ジャンル（食費・食料品）
const ZAIM_DEFAULT_CATEGORY_ID = 101;
const ZAIM_DEFAULT_GENRE_ID = 10101;
// Zaim登録時のコメントプレフィックス
const ZAIM_COMMENT_PREFIX = 'Created by GAS';

// -----------------------------------------------------------------------------
// Gmailラベル設定
// -----------------------------------------------------------------------------
// 処理対象のラベル名
const GMAIL_LABEL_UNPROCESSED = '家計簿/未処理';
// 処理済みラベル名
const GMAIL_LABEL_PROCESSED = '家計簿/処理済';

// -----------------------------------------------------------------------------
// メール検索設定
// -----------------------------------------------------------------------------
// キー: 内部識別子
// name: 表示名（ログ用）
// subj: Gmail検索用件名（完全一致または部分一致）
const PAYMENT_MAILTITLE_MAP = {
  'rakutenPay': {
    name: '楽天ペイ',
    subj: '楽天ペイアプリご利用内容確認メール',
  },
  'rakutenPayOnline': {
    name: '楽天ペイ',
    subj: '楽天ペイ 注文受付（自動配信メール）',
  },
  'rakutenCard': {
    name: '楽天カード',
    subj: 'カード利用のお知らせ', // 括弧を含む完全一致は検索できないため部分一致にする
  }
};

// -----------------------------------------------------------------------------
// カテゴリマッピング設定
// -----------------------------------------------------------------------------
// 店名とカテゴリの固定マッピング
// AI判定よりも優先されます。頻繁に利用する店やAIが誤判定する店を登録します。
// 値は { categoryId: カテゴリID, genreId: ジャンルID } のオブジェクトで指定します。
const SHOP_CATEGORY_MAP = {
  'Ｊリーグ': { categoryId: 108, genreId: 10802 }, // エンタメ - イベント
  'ユニクロ': { categoryId: 111, genreId: 11101 }, // 美容・衣服 - 洋服
  'でいから': { categoryId: 101, genreId: 10105 }, // 食費 - 食料品
  'そうてつローゼン': { categoryId: 101, genreId: 10101 }, // 食費 - 食料品
  '湯花楽': { categoryId: 108, genreId: 10801 }, // エンタメ - レジャー
  'ＦＷＤ生命保険': { categoryId: 110, genreId: 11003 }, // 医療・保険 - 生命保険
  'ﾓﾊﾞｲﾙﾊﾟｽﾓﾁﾔ-ｼﾞ': { categoryId: 199, genreId: 19999 }, // 交通 - 電車
  'ｵﾌﾛﾉｵｳｻﾏｴﾋﾞﾅﾃﾝ': { categoryId: 199, genreId: 19999 }, // その他
  'エルピオ': { categoryId: 105, genreId: 10503 }, // 水道・光熱 - 電気料金
  'ｽｽﾞﾗﾝ': { categoryId: 101, genreId: 10105 }, // 食費 - 食料品
  'ﾒｶﾞﾄﾞﾝｷﾎｰﾃ': { categoryId: 199, genreId: 19999 }, // その他
  '日本郵便': { categoryId: 104, genreId: 10406 }, // 通信 - 切手・はがき
  'ｺｽﾓｾｷﾕ': { categoryId: 112, genreId: 11201 }, // クルマ - ガソリン
  '楽天ブックス': { categoryId: 199, genreId: 19904 }, // その他 - 立替金
  'ｼｮﾃﾝ': { categoryId: 199, genreId: 19999 }, // その他 - その他
  'APPLE COM BILL': { categoryId: 104, genreId: 10401 }, // 通信 - 携帯電話料金
  'ﾋﾞﾖｳｼﾂ': { categoryId: 111, genreId: 11105 }, // 美容・衣服 - 美容院
  'ＮＵＲＯ光': { categoryId: 104, genreId: 10403 }, // 通信 - インターネット関連費
};

// カテゴリ名とZaimのID/ジャンルIDのマッピング
// ※ IDは checkCategories() の結果に基づき設定
// ※ ジャンルIDはデフォルト(categoryId * 100 + 01)と仮定しています
const CATEGORY_MAP = {
  '食費':       { id: 101, genreId: 10199 },
  '日用雑貨':   { id: 102, genreId: 10299 },
  '交通':       { id: 103, genreId: 10399 },
  '通信':       { id: 104, genreId: 10499 },
  '水道・光熱': { id: 105, genreId: 10599 },
  '住まい':     { id: 106, genreId: 10699 },
  '交際費':     { id: 107, genreId: 10799 },
  'エンタメ':   { id: 108, genreId: 10899 },
  '教育・教養': { id: 109, genreId: 10999 },
  '医療・保険': { id: 110, genreId: 11099 },
  '美容・衣服': { id: 111, genreId: 11199 },
  'クルマ':     { id: 112, genreId: 11299 },
  '税金':       { id: 113, genreId: 11399 },
  '大型出費':   { id: 114, genreId: 11499 },
  'その他':     { id: 199, genreId: 19999 }
};

// Zaimの全カテゴリ・ジャンル定義
// Geminiへのプロンプト生成に使用
const ZAIM_GENRES = {
  101: { name: '食費', genres: { 10101: '食料品', 10102: 'カフェ', 10103: '朝ご飯', 10104: '昼ご飯', 10105: '晩ご飯', 10199: 'その他' } },
  102: { name: '日用雑貨', genres: { 10201: '消耗品', 10202: '子ども関連', 10203: 'ペット関連', 10204: 'タバコ', 10299: 'その他' } },
  103: { name: '交通', genres: { 10301: '電車', 10302: 'タクシー', 10303: 'バス', 10304: '飛行機', 10399: 'その他' } },
  104: { name: '通信', genres: { 10401: '携帯電話料金', 10402: '固定電話料金', 10403: 'インターネット関連費', 10404: '放送サービス料金', 10405: '宅配便', 10406: '切手・はがき', 10499: 'その他' } },
  105: { name: '水道・光熱', genres: { 10501: '水道料金', 10502: '電気料金', 10503: 'ガス料金', 10599: 'その他' } },
  106: { name: '住まい', genres: { 10601: '家賃', 10602: '住宅ローン返済', 10603: '家具', 10604: '家電', 10605: 'リフォーム', 10606: '住宅保険', 10699: 'その他' } },
  107: { name: '交際費', genres: { 10701: '飲み会', 10702: 'プレゼント', 10703: 'ご祝儀・香典', 10799: 'その他' } },
  108: { name: 'エンタメ', genres: { 10801: 'レジャー', 10802: 'イベント', 10803: '映画・動画', 10804: '音楽', 10805: '漫画', 10806: '書籍', 10807: 'ゲーム', 10899: 'その他' } },
  109: { name: '教育・教養', genres: { 10901: '習い事', 10902: '新聞', 10903: '参考書', 10904: '受験料', 10905: '学費', 10906: '学資保険', 10907: '塾', 10999: 'その他' } },
  110: { name: '医療・保険', genres: { 11001: '病院代', 11002: '薬代', 11003: '生命保険', 11004: '医療保険', 11099: 'その他' } },
  111: { name: '美容・衣服', genres: { 11101: '洋服', 11102: 'アクセサリー・小物', 11103: '下着', 11104: 'ジム・健康', 11105: '美容院', 11106: 'コスメ', 11107: 'エステ・ネイル', 11108: 'クリーニング', 11199: 'その他' } },
  112: { name: 'クルマ', genres: { 11201: 'ガソリン', 11202: '駐車場', 11203: '自動車保険', 11204: '自動車税', 11205: '自動車ローン', 11206: '免許教習', 11207: '高速料金', 11299: 'その他' } },
  113: { name: '税金', genres: { 11301: '年金', 11302: '所得税', 11303: '消費税', 11304: '住民税', 11305: '個人事業税', 11399: 'その他' } },
  114: { name: '大型出費', genres: { 11401: '旅行', 11402: '住宅', 11403: '自動車', 11404: 'バイク', 11405: '結婚', 11406: '出産', 11407: '介護', 11408: '家具', 11409: '家電', 11499: 'その他' } },
  199: { name: 'その他', genres: { 19901: '仕送り', 19902: 'お小遣い', 19903: '使途不明金', 19904: '立替金', 19905: '未分類', 19906: '現金の引出', 19907: 'カードの引落', 19908: '電子マネーにチャージ', 19999: 'その他' } }
};

/*
 * 参考: カテゴリ・ジャンル一覧 (2025/12/05時点)
 *
 * カテゴリ: 食費 (ID: 101)
 *   └ ジャンル: 食料品 (ID: 10101)
 *   └ ジャンル: カフェ (ID: 10102)
 *   └ ジャンル: 朝ご飯 (ID: 10103)
 *   └ ジャンル: 昼ご飯 (ID: 10104)
 *   └ ジャンル: 晩ご飯 (ID: 10105)
 *   └ ジャンル: その他 (ID: 10199)
 * カテゴリ: 給与所得 (ID: 11)
 * カテゴリ: 日用雑貨 (ID: 102)
 *   └ ジャンル: 消耗品 (ID: 10201)
 *   └ ジャンル: 子ども関連 (ID: 10202)
 *   └ ジャンル: ペット関連 (ID: 10203)
 *   └ ジャンル: タバコ (ID: 10204)
 *   └ ジャンル: その他 (ID: 10299)
 * カテゴリ: 立替金返済 (ID: 12)
 * カテゴリ: 水道・光熱 (ID: 105)
 *   └ ジャンル: 水道料金 (ID: 10501)
 *   └ ジャンル: 電気料金 (ID: 10502)
 *   └ ジャンル: ガス料金 (ID: 10503)
 *   └ ジャンル: その他 (ID: 10599)
 * カテゴリ: 賞与 (ID: 13)
 * カテゴリ: 通信 (ID: 104)
 *   └ ジャンル: 携帯電話料金 (ID: 10401)
 *   └ ジャンル: 固定電話料金 (ID: 10402)
 *   └ ジャンル: インターネット関連費 (ID: 10403)
 *   └ ジャンル: 放送サービス料金 (ID: 10404)
 *   └ ジャンル: 宅配便 (ID: 10405)
 *   └ ジャンル: 切手・はがき (ID: 10406)
 *   └ ジャンル: その他 (ID: 10499)
 * カテゴリ: 臨時収入 (ID: 14)
 * カテゴリ: 交通 (ID: 103)
 *   └ ジャンル: 電車 (ID: 10301)
 *   └ ジャンル: タクシー (ID: 10302)
 *   └ ジャンル: バス (ID: 10303)
 *   └ ジャンル: 飛行機 (ID: 10304)
 *   └ ジャンル: その他 (ID: 10399)
 * カテゴリ: 事業所得 (ID: 15)
 * カテゴリ: 交際費 (ID: 107)
 *   └ ジャンル: 飲み会 (ID: 10701)
 *   └ ジャンル: プレゼント (ID: 10702)
 *   └ ジャンル: ご祝儀・香典 (ID: 10703)
 *   └ ジャンル: その他 (ID: 10799)
 * カテゴリ: その他 (ID: 19)
 * カテゴリ: エンタメ (ID: 108)
 *   └ ジャンル: レジャー (ID: 10801)
 *   └ ジャンル: イベント (ID: 10802)
 *   └ ジャンル: 映画・動画 (ID: 10803)
 *   └ ジャンル: 音楽 (ID: 10804)
 *   └ ジャンル: 漫画 (ID: 10805)
 *   └ ジャンル: 書籍 (ID: 10806)
 *   └ ジャンル: ゲーム (ID: 10807)
 *   └ ジャンル: その他 (ID: 10899)
 * カテゴリ: 美容・衣服 (ID: 111)
 *   └ ジャンル: 洋服 (ID: 11101)
 *   └ ジャンル: アクセサリー・小物 (ID: 11102)
 *   └ ジャンル: 下着 (ID: 11103)
 *   └ ジャンル: ジム・健康 (ID: 11104)
 *   └ ジャンル: 美容院 (ID: 11105)
 *   └ ジャンル: コスメ (ID: 11106)
 *   └ ジャンル: エステ・ネイル (ID: 11107)
 *   └ ジャンル: クリーニング (ID: 11108)
 *   └ ジャンル: その他 (ID: 11199)
 * カテゴリ: 医療・保険 (ID: 110)
 *   └ ジャンル: 病院代 (ID: 11001)
 *   └ ジャンル: 薬代 (ID: 11002)
 *   └ ジャンル: 生命保険 (ID: 11003)
 *   └ ジャンル: 医療保険 (ID: 11004)
 *   └ ジャンル: その他 (ID: 11099)
 * カテゴリ: 住まい (ID: 106)
 *   └ ジャンル: 家賃 (ID: 10601)
 *   └ ジャンル: 住宅ローン返済 (ID: 10602)
 *   └ ジャンル: 家具 (ID: 10603)
 *   └ ジャンル: 家電 (ID: 10604)
 *   └ ジャンル: リフォーム (ID: 10605)
 *   └ ジャンル: 住宅保険 (ID: 10606)
 *   └ ジャンル: その他 (ID: 10699)
 * カテゴリ: クルマ (ID: 112)
 *   └ ジャンル: ガソリン (ID: 11201)
 *   └ ジャンル: 駐車場 (ID: 11202)
 *   └ ジャンル: 自動車保険 (ID: 11203)
 *   └ ジャンル: 自動車税 (ID: 11204)
 *   └ ジャンル: 自動車ローン (ID: 11205)
 *   └ ジャンル: 免許教習 (ID: 11206)
 *   └ ジャンル: 高速料金 (ID: 11207)
 *   └ ジャンル: その他 (ID: 11299)
 * カテゴリ: 教育・教養 (ID: 109)
 *   └ ジャンル: 習い事 (ID: 10901)
 *   └ ジャンル: 新聞 (ID: 10902)
 *   └ ジャンル: 参考書 (ID: 10903)
 *   └ ジャンル: 受験料 (ID: 10904)
 *   └ ジャンル: 学費 (ID: 10905)
 *   └ ジャンル: 学資保険 (ID: 10906)
 *   └ ジャンル: 塾 (ID: 10907)
 *   └ ジャンル: その他 (ID: 10999)
 * カテゴリ: 税金 (ID: 113)
 *   └ ジャンル: 年金 (ID: 11301)
 *   └ ジャンル: 所得税 (ID: 11302)
 *   └ ジャンル: 消費税 (ID: 11303)
 *   └ ジャンル: 住民税 (ID: 11304)
 *   └ ジャンル: 個人事業税 (ID: 11305)
 *   └ ジャンル: その他 (ID: 11399)
 * カテゴリ: 大型出費 (ID: 114)
 *   └ ジャンル: 旅行 (ID: 11401)
 *   └ ジャンル: 住宅 (ID: 11402)
 *   └ ジャンル: 自動車 (ID: 11403)
 *   └ ジャンル: バイク (ID: 11404)
 *   └ ジャンル: 結婚 (ID: 11405)
 *   └ ジャンル: 出産 (ID: 11406)
 *   └ ジャンル: 介護 (ID: 11407)
 *   └ ジャンル: 家具 (ID: 11408)
 *   └ ジャンル: 家電 (ID: 11409)
 *   └ ジャンル: その他 (ID: 11499)
 * カテゴリ: その他 (ID: 199)
 *   └ ジャンル: 仕送り (ID: 19901)
 *   └ ジャンル: お小遣い (ID: 19902)
 *   └ ジャンル: 使途不明金 (ID: 19903)
 *   └ ジャンル: 立替金 (ID: 19904)
 *   └ ジャンル: 未分類 (ID: 19905)
 *   └ ジャンル: 現金の引出 (ID: 19906)
 *   └ ジャンル: カードの引落 (ID: 19907)
 *   └ ジャンル: 電子マネーにチャージ (ID: 19908)
 *   └ ジャンル: その他 (ID: 19999)
 */
