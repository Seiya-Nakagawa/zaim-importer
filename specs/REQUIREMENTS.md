# 要件定義書 (Requirements Definition)

## 1. プロジェクトの目的

楽天Payの利用通知メールを自動的に読み取り、家計簿アプリ「Zaim」に支出として自動登録することで、家計簿入力の手間を削減する。

## 2. 対象範囲 (Scope)

- **入力**: Gmailに着信する決済サービスの利用通知メール（初期リリースでは「楽天Pay」のみ対象。将来的に他サービスへ拡張予定）
- **出力**: Zaimへの支出データ登録

## 3. 機能要件 (Functional Requirements)

### 3.1. メール取得機能

- **Google Apps Script (GAS)** の `GmailApp` サービスを使用する。
- 指定された期間（日付範囲）のメールを対象とすること。
- 既読・未読を問わず、対象期間内のメールを処理できること。
- 特定の送信元（楽天Payなど）および件名でフィルタリングできること。
- 処理済みのメールには既読フラグを付与すること。

### 3.2. メール解析・カテゴリ判定機能

- 楽天Payのメール本文から以下の情報を正確に抽出できること。
  - 利用日時
  - 利用金額
  - 利用店舗名（または利用サービス名）
- **AI (LLM) を活用したカテゴリ自動判定**:
  - 抽出した「店舗名」と「金額」をAIに送信し、適切なZaimカテゴリ（食費、日用品、交通費など）を推論させる。
- 将来的に他の決済サービス（PayPay, Suica等）にも対応可能な拡張性を持つこと。

### 3.3. Zaim連携機能

- Zaim APIを使用して、抽出したデータを支出として登録できること。
- `UrlFetchApp` サービスを使用してAPIリクエストを行う。
- OAuth 1.0a 認証を実装する（GAS用のライブラリまたは自前実装）。

## 4. 非機能要件 (Non-Functional Requirements)

- **セキュリティ**:
  - Zaimの認証情報および **AIのAPIキー** は、GASのスクリプトプロパティで安全に管理すること。
- **運用**:
  - GASの **時間主導型トリガー**（Time-driven trigger）を使用する（例: 10分〜1時間ごと）。
  - ※Gmail着信トリガーはGAS単体では実装困難（GCP連携が必要）なため、ポーリング方式を採用する。
